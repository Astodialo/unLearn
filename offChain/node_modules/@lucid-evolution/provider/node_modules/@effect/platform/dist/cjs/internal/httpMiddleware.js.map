{"version":3,"file":"httpMiddleware.js","names":["Context","_interopRequireWildcard","require","Effect","FiberRef","_Function","_GlobalValue","Layer","Option","Headers","ServerError","ServerRequest","ServerResponse","TraceContext","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","make","middleware","exports","loggerDisabled","globalValue","Symbol","for","unsafeMake","withLoggerDisabled","self","zipRight","currentTracerDisabledWhen","constFalse","withTracerDisabledWhen","dual","pred","locally","withTracerDisabledWhenEffect","withTracerDisabledForUrls","urls","req","includes","url","logger","httpApp","counter","withFiberRuntime","fiber","context","getFiberRef","currentContext","request","unsafeGet","HttpServerRequest","withLogSpan","flatMap","exit","_tag","response","cause","causeResponseStripped","annotateLogs","log","value","method","status","tracer","disabled","getOrUndefined","toURL","undefined","username","password","redactedHeaderNames","currentRedactedNames","redactedHeaders","redact","headers","useSpan","parent","fromHeaders","kind","captureStackTrace","span","attribute","toString","pathname","query","search","slice","protocol","name","String","remoteAddress","withParentSpan","exitResponse","xForwardedHeaders","updateService","modify","split","trim","searchParamsParser","params","searchParamsFromURL","URL","add","ParsedSearchParams","cors","options","opts","allowedOrigins","allowedMethods","allowedHeaders","exposedHeaders","credentials","isAllowedOrigin","origin","allowOrigin","originHeader","length","vary","allowMethods","join","allowCredentials","allowHeaders","accessControlRequestHeaders","exposeHeaders","maxAge","corsHeaders","unsafeFromRecord","assign","succeed","empty","map","setHeaders"],"sources":["../../../src/internal/httpMiddleware.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}